#!/bin/bash
# 诺依阁<wkkjonlykang@vip.qq.com>
# 编写日期: 2025-03-31

echo "Welcome use nuoyis's lnmp service"

mkdir -p /web/nginx/webside/default/
mkdir -p /web/logs/{nginx,php/{latest,stable}}
# nginx/php 文件/服务检查
# 默认HTML
echo "check nginx service"
if [ ! -f "/web/nginx/conf/default.conf" ]; then
  echo "default page is not found. then create new default page of html"
  cp /web/nginx/server/template/index.html /web/nginx/webside/default/index.html
  cp /web/nginx/server/template/default.conf.init /web/nginx/conf/default.conf.init
else
  echo "default page is found. then use default page of html"
fi
cp /web/nginx/server/template/nginx.conf.full.template /web/nginx/conf/nginx.conf.full.template
cp /web/nginx/server/template/nginx.conf.succinct.template /web/nginx/conf/nginx.conf.succinct.template
touch /web/logs/nginx/error.log
touch /web/logs/php/latest/www-error.log
touch /web/logs/php/stable/www-error.log
echo "nginx service checkd"

# 重新设置文件权限,防止挂载权限拒绝
chown -R web:web /web/nginx/conf;
chown -R web:web /web/nginx/webside;
chown -R web:web /web/nginx/ssl;
chown -R web:web /web/logs;

echo "nuoyis service is starting"
echo "show starting logs at /var/log/web/"
exec "$@"
